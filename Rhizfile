; -*- mode: scheme -*-

(task
 "get-perlin"
 "Fetch the noise generator source code"
 (exec
  curl "https://raw.githubusercontent.com/josephg/noisejs/master/perlin.js"
  -o "static/perlin.js"))

(task
 "build"
 "Compile the app."
 (log "Starting build...")
 (empty-dir "build")
 (log "  Copying static files")
 (rec-copy "./static" "./build")
 (log "  Building TypeScript")
 (exec powershell -Command "tsc --outDir ./build")
 (log "  Building Elm")
 (exec powershell -Command "elm make ./src/Main.elm --output build/app.js")
 (log "done."))

(task
 "static"
 "Copy just the static files (for working on HTML & CSS)."
 (rec-copy "./static" "./build"))

(task
 "publish"
 "Push a new build to itch.io"
 (log "Publishing build to nknight.itch.io/by-sea-land-or-air")
 (exec butler push --if-changed build "nknight/by-sea-land-or-air:web")
 (log "done."))
